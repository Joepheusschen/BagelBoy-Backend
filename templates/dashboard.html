<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>BagelBoy Dashboard</title>
  <style>
    body {
      font-family: 'Gotham', sans-serif;
      background-color: #e6decf;
      padding: 2rem;
      color: #d3272e;
    }
    h1, h2 {
      color: #d3272e;
    }
    a {
      color: #d3272e;
      text-decoration: none;
      font-weight: bold;
    }
    .section {
      margin-bottom: 3rem;
    }
    .card {
      background-color: white;
      padding: 1rem;
      border-radius: 10px;
      margin: 1rem 0;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .btn {
      display: inline-block;
      padding: 0.5rem 1rem;
      margin-top: 1rem;
      margin-right: 1rem;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
      font-size: 0.95rem;
    }
    .next {
      background-color: #d3272e;
      color: white;
    }
    .reject {
      background-color: #888;
      color: white;
    }
  </style>
  <script>
    function confirmReject(rowId) {
      const choice = confirm("Send standard rejection mail?\nClick OK to send, or Cancel to adjust the message.");
      if (choice) {
        window.location.href = '/reject/' + rowId;
      } else {
        const customText = prompt("Edit the rejection message below:", 
`Unfortunately we have to let you know we have decided not to proceed with your application.
We thank you for your time and effort and wish you all of luck in your future endeavors.
Would you wish to have more information on this decision please contact Joep on 0681142820.`);
        if (customText) {
          fetch('/reject-custom/' + rowId, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ message: customText })
          }).then(() => window.location.reload());
        }
      }
    }
  </script>
</head>
<body>
  <h1>BagelBoy Applications</h1>
  <a href="/logout">Logout</a>

  {% for status, applications in grouped.items() %}
    <div class="section">
      <h2>Status: {{ status }}</h2>
      {% for row in applications %}
        <div class="card">
          <strong>{{ row['First name'] }} {{ row['Last name'] }}</strong><br>
          üìß {{ row['Email'] }}<br>
          üì± {{ row['Phone'] }}<br>
          ü•Ø Position: {{ row['Position'] }}<br>
          ‚è± Hours/week: {{ row['Hours'] }}<br>
          üìÜ Weekend: {{ row['Weekend'] }}<br>
          üí¨ Motivation:<br>
          <em>{{ row['Motivation'] }}</em><br>

          {% set row_id = row['row_id'] %}
          {% if status == 'New' %}
            <a href="/update-status/{{ row_id }}/1st meeting"><button class="btn next">To 1st meeting</button></a>
          {% elif status == '1st meeting' %}
            <a href="/update-status/{{ row_id }}/Trial"><button class="btn next">To Trial</button></a>
          {% elif status == 'Trial' %}
            <a href="/update-status/{{ row_id }}/Hired"><button class="btn next">To Hired</button></a>
          {% endif %}
          
          {% if status != 'Not hired' and status != 'Hired' %}
            <button class="btn reject" onclick="confirmReject({{ row_id }})">Don't proceed</button>
          {% endif %}
        </div>
      {% endfor %}
    </div>
  {% endfor %}
</body>
</html>
